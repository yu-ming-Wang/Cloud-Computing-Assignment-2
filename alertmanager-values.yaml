alertmanager:
  enabled: true
  config:
    global:
      resolve_timeout: 5m
    
    route:
      group_by: ['alertname', 'cluster', 'service']
      group_wait: 10s        # ç­‰å¾… 10 ç§’æ”¶é›†åŒçµ„å‘Šè­¦
      group_interval: 30s    # åŒçµ„æ–°å‘Šè­¦æœ€å°‘é–“éš” 30 ç§’ç™¼é€
      repeat_interval: 30m   # é‡è¤‡å‘Šè­¦é–“éš” 30 åˆ†é˜
      receiver: 'slack-notifications'
      routes:
      - match:
          alertname: Watchdog
        receiver: 'null'
      - match:
          severity: critical
        receiver: 'slack-critical'
        group_wait: 5s       # Critical å‘Šè­¦åªç­‰ 5 ç§’å°±ç™¼é€
        group_interval: 10s  # Critical å‘Šè­¦é–“éš”æ›´çŸ­
        repeat_interval: 15m # Critical å‘Šè­¦é‡è¤‡æ›´é »ç¹
      - match:
          severity: warning
        receiver: 'slack-warning'
        group_wait: 15s
        group_interval: 1m
    
    receivers:
    - name: 'null'
    
    - name: 'slack-notifications'
      slack_configs:
      - api_url: 'https://hooks.slack.com/services/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'
        channel: '#k8s-tests'  # ä½¿ç”¨ä½ çš„é »é“
        title: '{{ if eq .Status "firing" }}ğŸ”¥{{ else }}âœ…{{ end }} [{{ .Status | toUpper }}] {{ .GroupLabels.alertname }}'
        text: |
          {{ range .Alerts }}
          *Alert:* {{ .Labels.alertname }}
          *Severity:* {{ .Labels.severity }}
          *Summary:* {{ .Annotations.summary }}
          *Description:* {{ .Annotations.description }}
          {{ end }}
        send_resolved: true
        username: 'Alertmanager'
        icon_emoji: ':bell:'
    
    - name: 'slack-critical'
      slack_configs:
      - api_url: 'https://hooks.slack.com/services/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'
        channel: '#k8s-tests'  # ä½¿ç”¨ä½ çš„é »é“
        title: 'ğŸš¨ CRITICAL: {{ .GroupLabels.alertname }}'
        text: |
          {{ range .Alerts }}
          *Alert:* {{ .Labels.alertname }}
          *Severity:* {{ .Labels.severity }}
          *Instance:* {{ .Labels.instance }}
          *Summary:* {{ .Annotations.summary }}
          *Description:* {{ .Annotations.description }}
          *Time:* {{ .StartsAt.Format "15:04:05 MST" }}
          {{ end }}
        send_resolved: true
        username: 'Critical Alert'
        icon_emoji: ':rotating_light:'
    
    - name: 'slack-warning'
      slack_configs:
      - api_url: 'https://hooks.slack.com/services/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'
        channel: '#k8s-tests'  # ä½¿ç”¨ä½ çš„é »é“
        title: 'âš ï¸ Warning: {{ .GroupLabels.alertname }}'
        text: |
          {{ range .Alerts }}
          *Alert:* {{ .Labels.alertname }}
          *Severity:* {{ .Labels.severity }}
          *Summary:* {{ .Annotations.summary }}
          *Time:* {{ .StartsAt.Format "15:04:05 MST" }}
          {{ end }}
        send_resolved: true
        username: 'Warning Alert'
        icon_emoji: ':warning:'
    
    inhibit_rules:
    - source_match:
        severity: 'critical'
      target_match:
        severity: 'warning'
      equal: ['alertname', 'instance']